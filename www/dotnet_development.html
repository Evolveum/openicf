<html>
<head>
<title>Developing .NET Connector Bundles</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>
<div id="projecthome" class="app">
<h1>Developing .NET Connector Bundles</h1>
<p>The document describes the basic build environment for developing
.NET connectors.</p>
<p>Requirements:</p>
<ul>
    <li><a
        href="http://www.microsoft.com/downloads/details.aspx?FamilyID=333325FD-AE52-4E35-B531-508D977D32A6&amp;displaylang=en">.NET
    Framework 3.5</a></li>
    <li><a href="http://msbuildtasks.tigris.org/">MSBuild
    Community Tasks</a></li>
    <li><a href="http://www.nunit.org/index.php?p=download">NUnit
    2.4.x for .NET 2.0</a></li>
    <li><a href="http://wix.sourceforge.net/">Wix 3.0</a></li>
    <li><a href="http://subversion.tigris.org/">Subversion 1.4.x</a></li>
    <li><a href="http://www.microsoft.com/downloads/details.aspx?FamilyId=F26B1AA4-741A-433A-9BE5-FA919850BDBF&displaylang=en">Windows SDK for Windows Server 2008 and .NET Framework 3.5</a></li>
</ul>
<p>Recommended:</p>
<ul>
    <li><a href="">SharpDevelop 3.0</a> free IDE to develop .NET
    applications with plus it includes most of the dependencies.</li>
</ul>
<p>Its easy enough to simply checkout the entire source code base
from <strong>https://identityconnectors.dev.java.net/svn/identityconnectors/trunk/projects/dotnet</strong>.
All .NET based connectors (such as the Active Directory Connector) as well as the .NET version of the Connector Framework
live under this directory.
<h3>Checkout the code.</h3>
<pre>
C:\build&gt; svn checkout https://identityconnectors.dev.java.net/svn/identityconnectors/trunk/projects/dotnet dotnet 
</pre>
<h3>Directory Components</h3>
The layout to the .NET development directory is split into several smaller projects.
<ul>
	<li>Common - Assembly for all Framework and Connector common code.</li>
	<li>Console - Boo console to help hand test Connectors with automatic setup.</li>
	<li>Framework - Framework Assembly for Connector SPI/API plus remoting and server.</li>
	<li>FrameworkTests - NUnit Test Assembly to test all aspects of the framework.</li>
	<li>Serivce - Runs the Framework remoting server as a Windows Service.</li>
	<li>ServiceInstall - This is the install for the Windows Service.</li>
	<li>TestBundleV1 - Test Connector Bundle for use in FrameworkTests.</li>
	<li>TestBundleV2 - Test Connector Bundle for use in FrameworkTests with different version only same namespace.</li>
	<li>ToolkitInstall - Install for the Framework and Console for custom Connector development.</li>
</ul>
<h3>Build</h3>
<p>All .NET content is under the directory 'dotnet'.  There is a top level 
solution which can be used by SharpDevelop and Visual Studio 2008 (VS will 
complain because some of the projects are Wix based and not part of the 
standard set of MS projects).
<p>The .NET side of the project uses MSBuild exclusively because its compatible with the two most popular .NET development IDEs.
<p>To build simply install all the required software above.  If SharpDevelop is installed one should be able to just open the solution.  If Visual Studio is install it should work with the solution as well only it will complain about a few projects.  VS2008 will modify the solution and projects please *DO NOT* check them in unless you know exactly what your doing VS2008 tends to change it to whatever it wants with little regard to customization. The same can be said about SharpDevelop to some extent.
<p>For a command line build one environment variable must be set.  This is the location for Wix.  The environment variable WIX_HOME must be set in order to build.  You may need to add %WIX_HOME% to your PATH as well.
<div class="hint"><p><strong>Hint: </strong>msbuild.exe is located in your .NET Framework directory.  Most likely here: C:\WINDOWS\Microsoft.NET\Framework\v3.5</div>
<pre>
C:\build\identityconnectors\projects\dotnet&gt;msbuild "DotNetConnectors.sln"
Microsoft (R) Build Engine Version 3.5.21022.8
[Microsoft .NET Framework, Version 2.0.50727.1433]
Copyright (C) Microsoft Corporation 2007. All rights reserved.

Build started 5/14/2008 10:05:17 PM.
Project "C:\build\identityconnectors\projects\dotnet\DotNetConnectors.sln" on nod
e 0 (default targets).
  Building solution configuration "Debug|Any CPU".
Project "C:\build\identityconnectors\projects\dotnet\Connector Gateway.sln" (1) is
 building "C:\build\identityconnectors\projects\dotnet\Common\Common.csproj" (2) o
n node 0 (default targets).
Skipping target "CoreCompile" because all output files are up-to-date with resp
ect to the input files.
CopyFilesToOutputDirectory:
  Common -&gt; C:\build\identityconnectors\projects\dotnet\Common\bin\Debug\Common.dl
  l
Done Building Project "C:\build\identityconnectors\projects\dotnet\Common\Common.c
sproj" (default targets).

Project "C:\build\identityconnectors\projects\dotnet\Connector Gateway.sln" (1) is
 building "C:\build\identityconnectors\projects\dotnet\ServiceInstall\ServiceInsta
ll.wixproj" (3) on node 0 (default targets).

</pre>
<p>This will build everything and run all the Framework tests. The result is a full Remote Connector Framework Windows Service install.  The default configuration is 'Debug'.
<h3>Connector Development</h3>
<p>Connector bundles are simply .NET class libraries that follow some distinct patterns. Good examples are contained with in TestBundleV1 and TestBundleV2; these are skeletons to get you started. The only required references are the 'Common' and 'Framework' assemblies. These contain all the functionality necessary to create a .NET Connector.
<h3>Property Files in .NET</h3>
<p>On the Java side you will see the TestHelpers mechanism, which loads in configuration properties at runtime from several different sources. The .NET side has this functionality as well.
TestHelpers actually aggregates properties from potentially four different files, if they are present. It loads properties in the following order:</p>
<ol>
	<li><p><b>${user-home}/.connectors/connectors.xml</b>  //(optional) global properties file</p></li>
	<li><p><b>${bundle-dir}/project.xml</b> //(optional) public build properties file</p></li>
	<li><p><b>${user-home}/.connectors/${assembly-name}/project.xml</b>  //(optional) private build properties file</p></li>
    <li><p><b>${user-home}/.connectors/${assembly-name}/${configuration}/project.xml</b>  //(optional) configuration-specific properties file</p></li>
</ol>
<p><i>${assembly-name}</i> is the name of the calling assembly as defined in the connector's project (.csproj) file. Note that in this case all properties files are optional, whereas on the Java side, the second one is required. 
For an example project.xml file, take a look at the <a href="https://identityconnectors.dev.java.net/source/browse/identityconnectors/trunk/projects/dotnet/ActiveDirectoryConnectorTests/">ActiveDirectoryConnectorTests</a> project.</p>
</div>
</html>
