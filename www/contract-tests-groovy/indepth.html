<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<meta http-equiv="content-type" content="text/html; charset=windows-1250"><title>Groovy Contract Tests Manual -- In-depth</title>

</head>
<body>
<pre>-&lt;( <a href="index.html">Contract tests manual</a> &gt; In-depth manual )&gt;-</pre>
<hr style="width: 100%; height: 2px;">
<h1>In-depth guide</h1>
Table of contents:<br>
<ul>
<li><a href="#optionalprops">&nbsp; &nbsp;
</a></li>
<li>b</li>
<li>c</li>
</ul>
<hr style="width: 100%; height: 2px;">
<h2><a name="properties">Defining properties</a></h2>
<p>Test properties follows these patterns:</p>
<pre>// connector configuration<br>connector.{$property.name}="some value"<br>connector.connectionUrl="jdbc:mysql://localhost/database"<br><br>// testsuite configuration<br>testsuite.{$property.name}="some value"<br>testsuite.bundleJar=System.getProperty("connector-jar")<br><br>// DataProvider configuration<br>i{$iteration}.{$test.name}.{$oclass.name}.${attribute.name}="some value"<br>i0.Create.account.DEPARTMENT="some value"<br></pre>
<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">
<tbody>
<tr>
<td style="background-color: rgb(204, 204, 204);">
<p>Note 1: that <strong>case sensitivity is important</strong>.</p>
<p>Note 2: The <code>property.name</code> is
derived
from the setXYZ() method for the property (typically inside <code>FooConnectorConfiguration</code>
class).</p>
</td>
</tr>
</tbody>
</table>
<p></p>
<h3><a name="proplookup">Properties lookup</a></h3>
Properties are searched recursively. If a test looks for the property <code>connector.i1.wrong.login</code>
and doesn't find its definition
it tries to look for <code>i1.wrong.login</code>,
if still nothing found it tries <code>wrong.login</code>
etc. In last iteration, where there is nothing left from the originally
queried name, the GroovyDataProvider sets the default value according
to the type of the property.<!-- TODO: maybe addition info is needed to clarify this type resolution, see the place where the types are defined exactly.--><br>
<p>The values of the properties are evaluated at the initial
parsing of the property files. The only exception is a use of <span style="font-family: monospace;">Lazy.random()</span>, <span style="font-family: monospace;">Lazy.get()</span>
macros, as these implement lazy evaluation (just in the time of request
for property).
</p>
<p>
After property value is recursively found it is stored as the value of
the property that was initially looked up. For instance, test looks
for <code style="color: rgb(51, 51, 255);">connector.i1.wrong.login</code>
and
recursively finds <strong>value</strong> of&nbsp;<code style="color: rgb(0, 102, 0);">wrong.login</code>.
This <strong>value</strong>
will also be stored for <code style="color: rgb(51, 51, 255);">connector.i1.wrong.login</code>.
The next time test will look for the original property (<code style="color: rgb(51, 51, 255);">connector.i1.wrong...</code>),
its value
will be returned immediately.
</p>
<h3>Property value types</h3>
<p>Any Java type can be used (see <a href="index.html#stdgroovyimports">standard imports</a>),
in case you need additional types, take care of imports.<!-- TODO: v starych materialech v sekci Properties value types pod tabulkou tam je jeste poznamka o Guarded string a kol. Je to jeste porad platny? -->
&nbsp;
</p>
<p><span style="font-style: italic;">
Default value definitions</span> for property types are:
</p>
<pre>Tstring = Lazy.random("AAAAA##")<br>Tinteger= Lazy.random("##", Integer.class)<br>Tint= Lazy.random("##", Integer.class)<br>Tlong= Lazy.random("#####", Long.class)<br>// for full list of default values see /framework/contract-tests/src/bootstrap.groovy<br></pre>
<p>Properties that has not been defined, are assigned the default
values by GroovyDataProvider. So for instance&nbsp;the test looks
for property&nbsp;not yet defined: <span style="font-family: monospace; color: rgb(0, 153, 0);">i0.Create.account.DEPARTMENT</span>&nbsp;</p>
<ul>
<li>through recursive lookup it finds out that there is no such
a property</li>
<li>based on the type of&nbsp;<span style="font-family: monospace; color: rgb(0, 153, 0);">i0.Create.account.DEPARTMENT</span>
we return the default value:&nbsp; <span style="font-family: monospace;">Tstring =
Lazy.random("AAAAA##")</span> </li>
<li>expression on the right hand side is dynamically evaluated,
will result in random string according to pattern: 4 uppercase letters
concatenated with 2 digits (e.g.: JRIW87).</li>
</ul>
<h3>Macros</h3>
<p>There are no macros used in the new Groovy Contract tests,
however if you would like to transfer your old configuration there is a
<a href="appendix.html#transtable">Translation table</a>
to groovy.</p>
<h2>Configuring tests</h2>
<!-- ============================== -->
<h3><a name="minprop">Required properties</a></h3>
<h4>Bundle jar path</h4>
Path to connector distribution jar file (when compiled it is placed to <code>${project.name}/dist</code>
directory).
<pre>testsuite.bundleJar=System.getProperty("connector-jar") // connector-jar System property is set by ant to the current connector<br></pre>
Use the <code>System.getProperty()</code> call to get <code>connector-jar</code>
system property, which is set by <code>ant</code>.
<h4><a name="connconfprop">Connector configuration
properties</a></h4>
Properties declared in connector configuration bean (implementing <a href="http://idmvm120.central.sun.com/hudson/job/framework/javadoc/org/identityconnectors/framework/spi/Configuration.html"><code>Configuration</code></a>
interface) using following pattern:
<pre>connector.${property.name}=${value}<br></pre>
where <code>${property.name}</code> is a property of
configuration bean, <code>${value}</code> can be a value
(any java object).
<p>The following table represents two equivalent forms of
defining connector properties. In most cases<a href="#note1"><span style="color: rgb(51, 51, 255);">(*)</span></a>
we favor
option on the
right.
<table style="text-align: left; width: 100%;" border="1" cellpadding="2" cellspacing="2">
<tbody>
<tr>
<td>
<pre>// example configuration of database table connector for MySQL with sample values<br>connector.host="localhost"<br>connector.login="login"<br>connector.password="password"<br>connector.port="3306"<br>connector.driver="com.mysql.jdbc.Driver"<br>connector.usermodel="modeluser"</pre>
</td>
<td>
<pre>// example configuration of database table connector for MySQL with sample values<br>connector {<br> host="localhost"<br> login="login"<br> password="password"<br> port="3306"<br> driver="com.mysql.jdbc.Driver"<br> usermodel="modeluser"<br>} // connector</pre>
</td>
</tr>
<tr>
<td colspan="2" rowspan="2"><small><span style="color: rgb(51, 51, 255);">(*)</span><a name="note1"></a> Note 1:
property names containing special characters (invalid Java
identificators), such as <span style="font-family: monospace;">
@</span>, <span style="font-family: monospace;">
-</span>, etc. should be escaped. For instance
<span style="font-family: monospace;">testsuite.Schema."@@NAME@@".attribute.account.oclasses</span>.
However
property name cannot start with the escaped part (<span style="font-family: monospace;">@@NAME@@</span> in
this
case).<br>
Note 2: the prefix tree should be <span style="font-style: italic;">unique</span>
in the whole configuration
file (in this case <span style="font-family: monospace;">
connector { ... }</span> ).</small></td>
</tr>
</tbody>
</table>
</p>
<p>There are two classes of default values:</p>
<ol>
<li>[<span style="font-weight: bold;">Not supplied
default values</span>] Default values of properties: <code>connector.*</code>,
and <code>testsuite.*</code> is defined as&nbsp;<code>ObjectNotFoundException</code>
for
integer, float, double and string types to protect generation of random
values when configuration property definition is <span style="font-style: italic;">missing</span>.</li>
<li>[<span style="font-weight: bold;">Supplied
default values</span>] Default values for iterative properties
(e.g. <span style="font-family: monospace;">connector.i1.wrong.host</span>)
are listed here (and in <span style="font-family: monospace;">bootstrap.groovy</span>):
<br>
<!-- ======================= -->
<span style="font-family: monospace;">/*</span><br>
<span style="font-family: monospace;">&nbsp;*
Default data values for iterative types</span><br>
<span style="font-family: monospace;">&nbsp;*/</span><br>
<span style="font-family: monospace;">Tstring =
Lazy.random("AAAAA##")</span><br>
<span style="font-family: monospace;">Tinteger=
Lazy.random("##", Integer.class)</span><br>
<span style="font-family: monospace;">Tint=
Lazy.random("##", Integer.class)</span><br>
<span style="font-family: monospace;">Tlong=
Lazy.random("#####", Long.class)</span><br>
<span style="font-family: monospace;">Tbiginteger=Lazy.random("#####",
java.math.BigInteger.class)</span><br>
<span style="font-family: monospace;">Tfloat=Lazy.random("#####\\.##",
Float.class)</span><br>
<span style="font-family: monospace;">Tdouble=Lazy.random("#####\\.##",
Double.class)</span><br>
<span style="font-family: monospace;">Tbigdecimal=Lazy.random("#####\\.##",
java.math.BigDecimal.class)</span><br>
<span style="font-family: monospace;">Tboolean=false</span><br>
<span style="font-family: monospace;">Tbytearray=Lazy.random(".............",
byte[].class)</span><br>
<span style="font-family: monospace;">Tcharacter=Lazy.random(".",
Character.class)</span><br>
<br>
<span style="font-family: monospace;">// Default data
for multivalue attributes of common types</span><br>
<span style="font-family: monospace;">multi.Tstring=[Lazy.random("AAAAA##")
, Lazy.random("AAAAA##")]</span><br>
<span style="font-family: monospace;">multi.Tinteger=[Lazy.random("##",
Integer.class), Lazy.random("##", Integer.class)]</span><br>
<span style="font-family: monospace;">multi.Tlong=[Lazy.random("#####",
Long.class), Lazy.random("#####", Long.class)]</span><br>
<span style="font-family: monospace;">multi.Tbiginteger=[Lazy.random("#####",
java.math.BigInteger.class), Lazy.random("#####",
java.math.BigInteger.class)]</span><br>
<span style="font-family: monospace;">multi.Tfloat=[Lazy.random("#####\\.##",
Float.class), Lazy.random("#####\\.##", Float.class)]</span><br>
<span style="font-family: monospace;">multi.Tdouble=[Lazy.random("#####\\.##",
Double.class), Lazy.random("#####\\.##", Double.class)]</span><br>
<span style="font-family: monospace;">multi.Tbigdecimal=[Lazy.random("#####\\.##",
java.math.BigDecimal.class), Lazy.random("#####\\.##",
java.math.BigDecimal.class)]</span><br>
<span style="font-family: monospace;">multi.Tboolean=[false,
false]</span><br>
<span style="font-family: monospace;">multi.Tbytearray=</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;&nbsp;&nbsp;[Lazy.random(".............",
byte[].class), Lazy.random(".............", byte[].class)]</span><br>
<span style="font-family: monospace;">multi.Tcharacter
= [Lazy.random(".", Character.class), Lazy.random(".", Character.class)]</span><br>
<span style="font-family: monospace;">//:~ default
values</span><br>
<!-- ========================== --></li>
</ol>
<h4><a name="validateprop">ValidateApiOpTests
properties</a></h4>
It is necessary to define following properties:
<pre>// number of iterations ValidateApiOpTest will run<br>testsuite.i<span style="color: rgb(51, 51, 255);">${iterations}</span>.Validate=2 <br><br>// 1 stands for iteration number, property value should contain wrong configuration of connector-test that validate() will throw.<br>connector.i<span style="color: rgb(51, 51, 255);">1</span>.wrong.${property.name}=${value} <br>connector.i<span style="color: rgb(51, 102, 255);">2</span>.wrong.${property.name}=${value} //value used in the 2nd iteration<br></pre>
There should be at least one wrongly configured property per each
iteration otherwise test will fail.
<h4><a name="schemaprop">SchemaApiOpTests properties</a></h4>
<!-- note: this section is the same as in index.html / Quick start, point 4 -->
Define <span style="font-style: italic;">list</span>
of supported object classes by connector (see <a href="http://idmvm120.central.sun.com/hudson/job/framework/javadoc/org/identityconnectors/framework/common/objects/ObjectClass.html"><span style="font-family: monospace;">
ObjectClass.java</span></a> for up-to-date object class
types):<br>
<span style="font-family: monospace;">// database
table connector supports only object class 'account'</span><br>
<span style="font-family: monospace;">testsuite.Schema.oclasses=['account']</span>
<br>
<br>
Define list of attributes per <strong>each</strong>
supported object class:<br>
<span style="font-family: monospace;">// list of ALL
attributes of object class 'account' for database table connector:</span><br>
<span style="font-family: monospace;">testsuite.Schema.attributes.account.oclasses=['@@NAME@@',
'@@PASSWORD@@', 'MANAGER', 'MIDDLENAME', </span> (continued next
line)<br>
<span style="font-family: monospace;">&nbsp;&nbsp;
'FIRSTNAME', 'LASTNAME', 'EMAIL', 'DEPARTMENT', 'TITLE', 'AGE',
'SALARY', 'JPEGPHOTO']</span><br>
<br>
Define <strong>every</strong> attribute of <strong>each</strong>
object class:<br>
<span style="font-family: monospace;">// definition of
attribute @@NAME@@ of object class 'account' for databse table connector</span><br>
<span style="font-family: monospace;">testsuite.Schema."@@NAME@@".attribute.account.oclasses=[</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
type:
'java.lang.String',</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
readable:
"true",</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
createable:
"true",</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
updateable:
"true",</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
required:
"true",</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
multiValue:
"false",</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
returnedByDefault: "true" </span><br>
<span style="font-family: monospace;"> ]</span><br>
<br>
<br>
Define supported object classes by operations. Must contain <strong>exactly</strong>
the operations that are implemented by the connector:<br>
<span style="font-family: monospace;">// object
classes supported by operations for database table connector</span><br>
<span style="font-family: monospace;">Schema.operations=[</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
GetApiOp: ['account'],</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
SchemaApiOp: ['account'],</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
ValidateApiOp: ['account'],</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
CreateApiOp: ['account'],</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
SearchApiOp: ['account'],</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
DeleteApiOp: ['account'],</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
ScriptOnConnectorApiOp: ['account'],</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
UpdateApiOp: ['account'],</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
AuthenticationApiOp: ['account'],</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
TestApiOp: ['account'],</span><br>
<span style="font-family: monospace;">&nbsp;&nbsp;
SyncApiOp: []</span><br>
<span style="font-family: monospace;"> ]</span>
<h3><a name="optionalprops">Optional properties</a></h3>
<h4><a name="provprops">ScriptOnResourceApiOpTests,
ScriptOnConnectorApiOpTests properties</a></h4>
To be able to run ScriptOnResource and/or ScriptOnConnector tests it's
necessary to set following properties. If some of properties is not
set, test is skipped.
<pre>// Example properties for ScriptOnResource test<br>// Parameters required to construct ScriptContext object: <br>testsuite.language.ScriptOnResource="Groovy"<br>testsuite.script.ScriptOnResource="script text"<br>/* <br> // alternative: -- good for embedding scripts as a block:<br> testsuite.script.ScriptOnResource='''<br> multi line <br> script text<br> '''<br>*/<br>testsuite.arguments.ScriptOnResource=[<br> arg1: "value1", <br> arg2: "22.5"} <br>]//map<br><br>// Expected return value of ScriptOnResource#runScriptOnResource method:<br>// use suitable macro depending on what kind of object is expected<br>testsuite.result.ScriptOnResource=SomeObject<br></pre>
<code>ScriptOnResource</code> operation supports also
following <code>OperationOptions</code>. If none of them
is set <code>null</code> is used as <code>OperationOptions</code>.
If one or both are set
<code>OperationOptions</code> are built.
<pre>testsuite.RUN_AS_USER.ScriptOnResource="user"<br>testsuite.RUN_WITH_PASSWORD.ScriptOnResource="password"<br></pre>
<h4><a name="provprops">DataProvider properties</a></h4>
These properties define what values should be generated for object
classes' attributes returned in connector schema. These properies use
following pattern:
<pre><span style="color: rgb(51, 102, 255);">i</span>{$identityNumber}.{$test.name}.{$oclass.name}.${attribute.name}=some value<br></pre>
Some tests (Search, Multi) create more than one identity per test. <code><span style="color: rgb(51, 102, 255);">i</span>{$identityNumber}</code>
is serial number of the identity. <code>${test.name}</code>
is name of the test (Search, Create, ..., see <code>*ApiOpTests#TEST_NAME</code>).
<code>{$oclass.name}</code> is type of object class. <code>${attribute.name}</code>
is name of attribute of object class.<br>
Examples:
<pre>// first created account by CreateApiOpTests will have FIRSTNAME attribute equal to FOO<br><span style="color: rgb(51, 102, 255);">i</span>0.Create.account.FIRSTNAME="FOO"<br><br>// all accounts in SearchApiOpTests will have LASTNAME attribute equal to BAR<br>Search.account.LASTNAME="BAR"<br><br>// all accounts in all tests will have PHONE attribute equal to 5-digit random values<br>account.PHONE=Lazy.random("######") <br></pre>
<h4>UpdateApiOpTests</h4>
In the <code>UpdateApiOpTests</code> is created identity
updated with new values. For those new values are used following
properties:
<pre>modified.${attribute.name}=${value}<br><br>// update LASTNAME attribute with value "sellers"<br>modified.LASTNAME="sellers"<br><br>// if you don't want so supply new value for update set it to the ObjectNotFoundException exception:<br>modified."@@NAME@@"= <span style="font-family: monospace;">ObjectNotFoundException() // means that value is not supplied</span><br></pre>
<!-- -------------========== -->
</body></html>